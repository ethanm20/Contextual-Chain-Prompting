,Unnamed: 0,Access Gained,Attack Origin,Authentication Required,Availability,CVE ID,CVE Page,CWE ID,Complexity,Confidentiality,Integrity,Known Exploits,Publish Date,Score,Summary,Update Date,Vulnerability Classification,add_lines,codeLink,commit_id,commit_message,del_lines,file_name,files_changed,func_after,func_before,lang,lines_after,lines_before,parentID,patch,project,project_after,project_before,vul,vul_func_with_fix
5185,182921,,Remote,Not required,,CVE-2019-3877,https://www.cvedetails.com/cve/CVE-2019-3877/,CWE-601,Medium,,Partial,,2019-03-27,4.3,"A vulnerability was found in mod_auth_mellon before v0.14.2. An open redirect in the logout URL allows requests with backslashes to pass through by assuming that it is a relative URL, while the browsers silently convert backslash characters into forward slashes treating them as an absolute URL. This mismatch allows an attacker to bypass the redirect URL validation logic in apr_uri_parse function.",2019-04-16,Bypass ,7,https://github.com/Uninett/mod_auth_mellon/commit/62041428a32de402e0be6ba45fe12df6a83bedb8,62041428a32de402e0be6ba45fe12df6a83bedb8,"Fix redirect URL validation bypass

It turns out that browsers silently convert backslash characters into
forward slashes, while apr_uri_parse() does not.

This mismatch allows an attacker to bypass the redirect URL validation
by using an URL like:

  https://sp.example.org/mellon/logout?ReturnTo=https:%5c%5cmalicious.example.org/

mod_auth_mellon will assume that it is a relative URL and allow the
request to pass through, while the browsers will use it as an absolute
url and redirect to https://malicious.example.org/ .

This patch fixes this issue by rejecting all redirect URLs with
backslashes.",0,auth_mellon_util.c,"{""sha"": ""fd442f90e4f12669e18f64095c441881b8614c8d"", ""filename"": ""auth_mellon_util.c"", ""status"": ""modified"", ""additions"": 7, ""deletions"": 0, ""changes"": 7, ""blob_url"": ""https://github.com/Uninett/mod_auth_mellon/blob/62041428a32de402e0be6ba45fe12df6a83bedb8/auth_mellon_util.c"", ""raw_url"": ""https://github.com/Uninett/mod_auth_mellon/raw/62041428a32de402e0be6ba45fe12df6a83bedb8/auth_mellon_util.c"", ""contents_url"": ""https://api.github.com/repos/Uninett/mod_auth_mellon/contents/auth_mellon_util.c?ref=62041428a32de402e0be6ba45fe12df6a83bedb8"", ""patch"": ""@@ -927,6 +927,13 @@ int am_check_url(request_rec *r, const char *url)\n                           \""Control character detected in URL.\"");\n             return HTTP_BAD_REQUEST;\n         }\n+        if (*i == '\\\\') {\n+            /* Reject backslash character, as it can be used to bypass\n+             * redirect URL validation. */\n+            AM_LOG_RERROR(APLOG_MARK, APLOG_ERR, HTTP_BAD_REQUEST, r,\n+                          \""Backslash character detected in URL.\"");\n+            return HTTP_BAD_REQUEST;\n+        }\n     }\n \n     return OK;""}","int am_check_url(request_rec *r, const char *url)
{
    const char *i;

    for (i = url; *i; i++) {
        if (*i >= 0 && *i < ' ') {
            /* Deny all control-characters. */
            AM_LOG_RERROR(APLOG_MARK, APLOG_ERR, HTTP_BAD_REQUEST, r,
                           ""Control character detected in URL."");
             return HTTP_BAD_REQUEST;
         }
        if (*i == '\\') {
            /* Reject backslash character, as it can be used to bypass
             * redirect URL validation. */
            AM_LOG_RERROR(APLOG_MARK, APLOG_ERR, HTTP_BAD_REQUEST, r,
                          ""Backslash character detected in URL."");
            return HTTP_BAD_REQUEST;
        }
     }
 
     return OK;
}
","int am_check_url(request_rec *r, const char *url)
{
    const char *i;

    for (i = url; *i; i++) {
        if (*i >= 0 && *i < ' ') {
            /* Deny all control-characters. */
            AM_LOG_RERROR(APLOG_MARK, APLOG_ERR, HTTP_BAD_REQUEST, r,
                           ""Control character detected in URL."");
             return HTTP_BAD_REQUEST;
         }
     }
 
     return OK;
}
",C,"        if (*i == '\\') {
            /* Reject backslash character, as it can be used to bypass
             * redirect URL validation. */
            AM_LOG_RERROR(APLOG_MARK, APLOG_ERR, HTTP_BAD_REQUEST, r,
                          ""Backslash character detected in URL."");
            return HTTP_BAD_REQUEST;
        }
",,,"@@ -927,6 +927,13 @@ int am_check_url(request_rec *r, const char *url)
                           ""Control character detected in URL."");
             return HTTP_BAD_REQUEST;
         }
+        if (*i == '\\') {
+            /* Reject backslash character, as it can be used to bypass
+             * redirect URL validation. */
+            AM_LOG_RERROR(APLOG_MARK, APLOG_ERR, HTTP_BAD_REQUEST, r,
+                          ""Backslash character detected in URL."");
+            return HTTP_BAD_REQUEST;
+        }
     }
 
     return OK;",mod_auth_mellon,62041428a32de402e0be6ba45fe12df6a83bedb8,7bc436760d10edb4be27fc326548ef3e7ffddf65,1,"int am_check_url(request_rec *r, const char *url)
{
    const char *i;

    for (i = url; *i; i++) {
        if (*i >= 0 && *i < ' ') {
            /* Deny all control-characters. */
            AM_LOG_RERROR(APLOG_MARK, APLOG_ERR, HTTP_BAD_REQUEST, r,
                           ""Control character detected in URL."");
             return HTTP_BAD_REQUEST;
         }
//fix_flaw_line_below:
//        if (*i == '\\') {
//fix_flaw_line_below:
//            /* Reject backslash character, as it can be used to bypass
//fix_flaw_line_below:
//             * redirect URL validation. */
//fix_flaw_line_below:
//            AM_LOG_RERROR(APLOG_MARK, APLOG_ERR, HTTP_BAD_REQUEST, r,
//fix_flaw_line_below:
//                          ""Backslash character detected in URL."");
//fix_flaw_line_below:
//            return HTTP_BAD_REQUEST;
//fix_flaw_line_below:
//        }
     }
 
     return OK;
}
"
9169,186905,,Remote,Not required,,CVE-2017-15419,https://www.cvedetails.com/cve/CVE-2017-15419/,CWE-601,Medium,Partial,,,2018-08-28,4.3,Insufficient policy enforcement in Resource Timing API in Google Chrome prior to 63.0.3239.84 allowed a remote attacker to infer browsing history by triggering a leaked cross-origin URL via a crafted HTML page.,2018-11-07,,0,https://github.com/chromium/chromium/commit/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6,fa17c9878dbeebf991b25ac0deb2b4635d85f1b6,"Resource Timing: Do not report subsequent navigations within subframes

We only want to record resource timing for the load that was initiated
by parent document. We filter out subsequent navigations for <iframe>,
but we should do it for other types of subframes too.

Bug: 780312
Change-Id: I3a7b9e1a365c99e24bb8dac190e88c7099fc3da5
Reviewed-on: https://chromium-review.googlesource.com/750487
Reviewed-by: Nate Chapin <japhet@chromium.org>
Commit-Queue: Kunihiko Sakamoto <ksakamoto@chromium.org>
Cr-Commit-Position: refs/heads/master@{#513665}",1,third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.cpp,"{""sha"": ""5843f88307233e9326c84106f460039baf09162e"", ""filename"": ""third_party/WebKit/LayoutTests/external/wpt/resource-timing/resource_subframe_self_navigation.html"", ""status"": ""added"", ""additions"": 53, ""deletions"": 0, ""changes"": 53, ""blob_url"": ""https://github.com/chromium/chromium/blob/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resource_subframe_self_navigation.html"", ""raw_url"": ""https://github.com/chromium/chromium/raw/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resource_subframe_self_navigation.html"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resource_subframe_self_navigation.html?ref=fa17c9878dbeebf991b25ac0deb2b4635d85f1b6"", ""patch"": ""@@ -0,0 +1,53 @@\n+<!DOCTYPE html>\n+<script src=\""/resources/testharness.js\""></script>\n+<script src=\""/resources/testharnessreport.js\""></script>\n+<body>\n+<script>\n+function numberOfDownloads(url) {\n+    let absoluteURL = new URL(url, location.href).href;\n+    return performance.getEntriesByName(absoluteURL).length;\n+}\n+\n+function waitForSubFrameLoad() {\n+    return new Promise((resolve) => {\n+        window.subFrameLoaded = () => {\n+            window.subFrameLoaded = null;\n+            resolve();\n+        };\n+    });\n+}\n+\n+function runTest(type) {\n+    performance.clearResourceTimings();\n+    let elem = document.createElement(type);\n+    if (type === 'object')\n+        elem.data = 'resources/self_navigation.html?' + type;\n+    else\n+        elem.src = 'resources/self_navigation.html?' + type;\n+    document.body.appendChild(elem);\n+    return waitForSubFrameLoad().then(() => {\n+        let resources = performance.getEntriesByType('resource');\n+        assert_equals(numberOfDownloads('resources/self_navigation.html?' + type), 1);\n+        assert_equals(numberOfDownloads('resources/notify_parent.html?redirected'), 0);\n+        document.body.removeChild(elem);\n+    });\n+}\n+\n+promise_test(\n+    () => runTest('iframe'),\n+    \""Subsequent <iframe> navigations don't appear in the resource-timing buffer.\"");\n+\n+promise_test(\n+    () => runTest('frame'),\n+    \""Subsequent <frame> navigations don't appear in the resource-timing buffer.\"");\n+\n+promise_test(\n+    () => runTest('embed'),\n+    \""Subsequent <embed> navigations don't appear in the resource-timing buffer.\"");\n+\n+promise_test(\n+    () => runTest('object'),\n+    \""Subsequent <object> navigations don't appear in the resource-timing buffer.\"");\n+\n+</script>\n+</body>""}<_**next**_>{""sha"": ""c104f3c8f0695a96646cf24a730eef0342f95876"", ""filename"": ""third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/notify_parent.html"", ""status"": ""added"", ""additions"": 4, ""deletions"": 0, ""changes"": 4, ""blob_url"": ""https://github.com/chromium/chromium/blob/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/notify_parent.html"", ""raw_url"": ""https://github.com/chromium/chromium/raw/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/notify_parent.html"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/notify_parent.html?ref=fa17c9878dbeebf991b25ac0deb2b4635d85f1b6"", ""patch"": ""@@ -0,0 +1,4 @@\n+<!DOCTYPE html>\n+<script>\n+window.parent.subFrameLoaded();\n+</script>""}<_**next**_>{""sha"": ""beb12f5da551780fcb4378bef4661b9699a5d009"", ""filename"": ""third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/self_navigation.html"", ""status"": ""added"", ""additions"": 1, ""deletions"": 0, ""changes"": 1, ""blob_url"": ""https://github.com/chromium/chromium/blob/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/self_navigation.html"", ""raw_url"": ""https://github.com/chromium/chromium/raw/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/self_navigation.html"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/self_navigation.html?ref=fa17c9878dbeebf991b25ac0deb2b4635d85f1b6"", ""patch"": ""@@ -0,0 +1 @@\n+<meta http-equiv=\""refresh\"" content=\""0;url=notify_parent.html?redirected\"">""}<_**next**_>{""sha"": ""7102f3bceed8f489689bfd57c64344a3aab19c2d"", ""filename"": ""third_party/WebKit/LayoutTests/http/tests/w3c/webperf/submission/Google/resource-timing/html/test_resource_iframe_self_navigation.html"", ""status"": ""removed"", ""additions"": 0, ""deletions"": 48, ""changes"": 48, ""blob_url"": ""https://github.com/chromium/chromium/blob/c858650450f51cbff4a48689f9431b3b491d39e0/third_party/WebKit/LayoutTests/http/tests/w3c/webperf/submission/Google/resource-timing/html/test_resource_iframe_self_navigation.html"", ""raw_url"": ""https://github.com/chromium/chromium/raw/c858650450f51cbff4a48689f9431b3b491d39e0/third_party/WebKit/LayoutTests/http/tests/w3c/webperf/submission/Google/resource-timing/html/test_resource_iframe_self_navigation.html"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/LayoutTests/http/tests/w3c/webperf/submission/Google/resource-timing/html/test_resource_iframe_self_navigation.html?ref=c858650450f51cbff4a48689f9431b3b491d39e0"", ""patch"": ""@@ -1,48 +0,0 @@\n-<!DOCTYPE html>\n-<html>\n-<head>\n-<meta charset=\""utf-8\"" />\n-<title>Resource Timing self navigating iframes</title>\n-<link rel=\""author\"" title=\""Google\"" href=\""http://www.google.com/\"" />\n-<link rel=\""help\"" href=\""http://www.w3.org/TR/resource-timing/#dom-performanceresourcetiming-initiatortype\""/>\n-<script src=\""/w3c/resources/testharness.js\""></script>\n-<script src=\""/w3c/resources/testharnessreport.js\""></script>\n-<script src=\""/w3c/webperf/resources/webperftestharness.js\""></script>\n-<script src=\""/w3c/webperf/resources/webperftestharnessextension.js\""></script>\n-<script>\n-setup({explicit_done: true});\n-var d;\n-var iframe;\n-var iframeBody;\n-function setup_iframe() {\n-    var iframe_content = '<iframe id=\""innerFrame\"" src=\""/w3c/webperf/resources/inject_resource_test.html\""></iframe>';\n-    iframe = document.getElementById('frameContext');\n-    d = iframe.contentWindow.document;\n-    d.write(iframe_content);\n-    iframe.contentWindow.setup_iframe = setup_inner_iframe;\n-}\n-function setup_inner_iframe() {\n-    var iframe_content = '<script>window.location = \""/w3c/webperf/resources/generate_resource.php?type=iframe\"";</scr' + 'ipt>';\n-    var inner_iframe = d.getElementById('innerFrame');\n-    inner_iframe.contentWindow.document.write(iframe_content);\n-    inner_iframe.addEventListener(\""load\"", onload_test);\n-}\n-function onload_test() {\n-    var context = new PerformanceContext(iframe.contentWindow.performance);\n-    var entries = context.getEntriesByType('resource');\n-    var expected_entries = {\n-        '/w3c/webperf/resources/inject_resource_test.html': 'iframe',\n-    };\n-    test_resource_entries(entries, expected_entries);\n-    done();\n-}\n-window.setup_iframe = setup_iframe;\n-</script>\n-</head>\n-<body>\n-<h1>Description</h1>\n-<p>This test validates that iframes that navigate themselves don't appear in the buffer.</p>\n-<div id=\""log\""></div>\n-<iframe id=\""frameContext\"" src=\""/w3c/webperf/resources/inject_resource_test.html\""></iframe>\n-</body>\n-</html>""}<_**next**_>{""sha"": ""5494433ea6ad7cc21783cb462a95fcafd354047e"", ""filename"": ""third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.cpp"", ""status"": ""modified"", ""additions"": 2, ""deletions"": 1, ""changes"": 3, ""blob_url"": ""https://github.com/chromium/chromium/blob/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.cpp"", ""raw_url"": ""https://github.com/chromium/chromium/raw/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.cpp"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.cpp?ref=fa17c9878dbeebf991b25ac0deb2b4635d85f1b6"", ""patch"": ""@@ -78,7 +78,8 @@ HTMLFrameOwnerElement::HTMLFrameOwnerElement(const QualifiedName& tag_name,\n     : HTMLElement(tag_name, document),\n       content_frame_(nullptr),\n       embedded_content_view_(nullptr),\n-      sandbox_flags_(kSandboxNone) {}\n+      sandbox_flags_(kSandboxNone),\n+      did_load_non_empty_document_(false) {}\n \n LayoutEmbeddedContent* HTMLFrameOwnerElement::GetLayoutEmbeddedContent() const {\n   // HTMLObjectElement and HTMLEmbedElement may return arbitrary layoutObjects""}<_**next**_>{""sha"": ""d44d67c261cb07435fc847ca278f9bff596c6713"", ""filename"": ""third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h"", ""status"": ""modified"", ""additions"": 3, ""deletions"": 2, ""changes"": 5, ""blob_url"": ""https://github.com/chromium/chromium/blob/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h"", ""raw_url"": ""https://github.com/chromium/chromium/raw/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h?ref=fa17c9878dbeebf991b25ac0deb2b4635d85f1b6"", ""patch"": ""@@ -63,8 +63,8 @@ class CORE_EXPORT HTMLFrameOwnerElement : public HTMLElement,\n \n   Document* getSVGDocument(ExceptionState&) const;\n \n-  virtual bool LoadedNonEmptyDocument() const { return false; }\n-  virtual void DidLoadNonEmptyDocument() {}\n+  bool LoadedNonEmptyDocument() const { return did_load_non_empty_document_; }\n+  void DidLoadNonEmptyDocument() { did_load_non_empty_document_ = true; }\n \n   void SetEmbeddedContentView(EmbeddedContentView*);\n   EmbeddedContentView* ReleaseEmbeddedContentView();\n@@ -169,6 +169,7 @@ class CORE_EXPORT HTMLFrameOwnerElement : public HTMLElement,\n   Member<Frame> content_frame_;\n   Member<EmbeddedContentView> embedded_content_view_;\n   SandboxFlags sandbox_flags_;\n+  bool did_load_non_empty_document_;\n \n   WebParsedFeaturePolicy container_policy_;\n };""}<_**next**_>{""sha"": ""c25fe82ccd1e9bb5fc85b22f69c84628d7efcd9e"", ""filename"": ""third_party/WebKit/Source/core/html/HTMLIFrameElement.cpp"", ""status"": ""modified"", ""additions"": 0, ""deletions"": 1, ""changes"": 1, ""blob_url"": ""https://github.com/chromium/chromium/blob/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLIFrameElement.cpp"", ""raw_url"": ""https://github.com/chromium/chromium/raw/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLIFrameElement.cpp"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/Source/core/html/HTMLIFrameElement.cpp?ref=fa17c9878dbeebf991b25ac0deb2b4635d85f1b6"", ""patch"": ""@@ -39,7 +39,6 @@ using namespace HTMLNames;\n \n inline HTMLIFrameElement::HTMLIFrameElement(Document& document)\n     : HTMLFrameElementBase(iframeTag, document),\n-      did_load_non_empty_document_(false),\n       collapsed_by_client_(false),\n       sandbox_(HTMLIFrameElementSandbox::Create(this)),\n       referrer_policy_(kReferrerPolicyDefault) {}""}<_**next**_>{""sha"": ""0bdd164aabbe80c752fac712c2dcb97e29ee3568"", ""filename"": ""third_party/WebKit/Source/core/html/HTMLIFrameElement.h"", ""status"": ""modified"", ""additions"": 0, ""deletions"": 7, ""changes"": 7, ""blob_url"": ""https://github.com/chromium/chromium/blob/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLIFrameElement.h"", ""raw_url"": ""https://github.com/chromium/chromium/raw/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLIFrameElement.h"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/Source/core/html/HTMLIFrameElement.h?ref=fa17c9878dbeebf991b25ac0deb2b4635d85f1b6"", ""patch"": ""@@ -66,12 +66,6 @@ class CORE_EXPORT HTMLIFrameElement final\n   bool LayoutObjectIsNeeded(const ComputedStyle&) override;\n   LayoutObject* CreateLayoutObject(const ComputedStyle&) override;\n \n-  bool LoadedNonEmptyDocument() const override {\n-    return did_load_non_empty_document_;\n-  }\n-  void DidLoadNonEmptyDocument() override {\n-    did_load_non_empty_document_ = true;\n-  }\n   bool IsInteractiveContent() const override;\n \n   ReferrerPolicy ReferrerPolicyAttribute() override;\n@@ -84,7 +78,6 @@ class CORE_EXPORT HTMLIFrameElement final\n   AtomicString name_;\n   AtomicString csp_;\n   AtomicString allow_;\n-  bool did_load_non_empty_document_;\n   bool allow_fullscreen_;\n   bool allow_payment_request_;\n   bool collapsed_by_client_;""}","HTMLFrameOwnerElement::HTMLFrameOwnerElement(const QualifiedName& tag_name,
                                             Document& document)
     : HTMLElement(tag_name, document),
       content_frame_(nullptr),
       embedded_content_view_(nullptr),
","HTMLFrameOwnerElement::HTMLFrameOwnerElement(const QualifiedName& tag_name,
                                             Document& document)
     : HTMLElement(tag_name, document),
       content_frame_(nullptr),
       embedded_content_view_(nullptr),
      sandbox_flags_(kSandboxNone) {}
",C,,"      sandbox_flags_(kSandboxNone) {}
",,"@@ -78,7 +78,8 @@ HTMLFrameOwnerElement::HTMLFrameOwnerElement(const QualifiedName& tag_name,
     : HTMLElement(tag_name, document),
       content_frame_(nullptr),
       embedded_content_view_(nullptr),
-      sandbox_flags_(kSandboxNone) {}
+      sandbox_flags_(kSandboxNone),
+      did_load_non_empty_document_(false) {}
 
 LayoutEmbeddedContent* HTMLFrameOwnerElement::GetLayoutEmbeddedContent() const {
   // HTMLObjectElement and HTMLEmbedElement may return arbitrary layoutObjects",Chrome,fa17c9878dbeebf991b25ac0deb2b4635d85f1b6,c858650450f51cbff4a48689f9431b3b491d39e0,1,"HTMLFrameOwnerElement::HTMLFrameOwnerElement(const QualifiedName& tag_name,
                                             Document& document)
     : HTMLElement(tag_name, document),
       content_frame_(nullptr),
       embedded_content_view_(nullptr),
//flaw_line_below:
      sandbox_flags_(kSandboxNone) {}
"
9170,186906,,Remote,Not required,,CVE-2017-15419,https://www.cvedetails.com/cve/CVE-2017-15419/,CWE-601,Medium,Partial,,,2018-08-28,4.3,Insufficient policy enforcement in Resource Timing API in Google Chrome prior to 63.0.3239.84 allowed a remote attacker to infer browsing history by triggering a leaked cross-origin URL via a crafted HTML page.,2018-11-07,,0,https://github.com/chromium/chromium/commit/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6,fa17c9878dbeebf991b25ac0deb2b4635d85f1b6,"Resource Timing: Do not report subsequent navigations within subframes

We only want to record resource timing for the load that was initiated
by parent document. We filter out subsequent navigations for <iframe>,
but we should do it for other types of subframes too.

Bug: 780312
Change-Id: I3a7b9e1a365c99e24bb8dac190e88c7099fc3da5
Reviewed-on: https://chromium-review.googlesource.com/750487
Reviewed-by: Nate Chapin <japhet@chromium.org>
Commit-Queue: Kunihiko Sakamoto <ksakamoto@chromium.org>
Cr-Commit-Position: refs/heads/master@{#513665}",1,third_party/WebKit/Source/core/html/HTMLIFrameElement.cpp,"{""sha"": ""5843f88307233e9326c84106f460039baf09162e"", ""filename"": ""third_party/WebKit/LayoutTests/external/wpt/resource-timing/resource_subframe_self_navigation.html"", ""status"": ""added"", ""additions"": 53, ""deletions"": 0, ""changes"": 53, ""blob_url"": ""https://github.com/chromium/chromium/blob/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resource_subframe_self_navigation.html"", ""raw_url"": ""https://github.com/chromium/chromium/raw/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resource_subframe_self_navigation.html"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resource_subframe_self_navigation.html?ref=fa17c9878dbeebf991b25ac0deb2b4635d85f1b6"", ""patch"": ""@@ -0,0 +1,53 @@\n+<!DOCTYPE html>\n+<script src=\""/resources/testharness.js\""></script>\n+<script src=\""/resources/testharnessreport.js\""></script>\n+<body>\n+<script>\n+function numberOfDownloads(url) {\n+    let absoluteURL = new URL(url, location.href).href;\n+    return performance.getEntriesByName(absoluteURL).length;\n+}\n+\n+function waitForSubFrameLoad() {\n+    return new Promise((resolve) => {\n+        window.subFrameLoaded = () => {\n+            window.subFrameLoaded = null;\n+            resolve();\n+        };\n+    });\n+}\n+\n+function runTest(type) {\n+    performance.clearResourceTimings();\n+    let elem = document.createElement(type);\n+    if (type === 'object')\n+        elem.data = 'resources/self_navigation.html?' + type;\n+    else\n+        elem.src = 'resources/self_navigation.html?' + type;\n+    document.body.appendChild(elem);\n+    return waitForSubFrameLoad().then(() => {\n+        let resources = performance.getEntriesByType('resource');\n+        assert_equals(numberOfDownloads('resources/self_navigation.html?' + type), 1);\n+        assert_equals(numberOfDownloads('resources/notify_parent.html?redirected'), 0);\n+        document.body.removeChild(elem);\n+    });\n+}\n+\n+promise_test(\n+    () => runTest('iframe'),\n+    \""Subsequent <iframe> navigations don't appear in the resource-timing buffer.\"");\n+\n+promise_test(\n+    () => runTest('frame'),\n+    \""Subsequent <frame> navigations don't appear in the resource-timing buffer.\"");\n+\n+promise_test(\n+    () => runTest('embed'),\n+    \""Subsequent <embed> navigations don't appear in the resource-timing buffer.\"");\n+\n+promise_test(\n+    () => runTest('object'),\n+    \""Subsequent <object> navigations don't appear in the resource-timing buffer.\"");\n+\n+</script>\n+</body>""}<_**next**_>{""sha"": ""c104f3c8f0695a96646cf24a730eef0342f95876"", ""filename"": ""third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/notify_parent.html"", ""status"": ""added"", ""additions"": 4, ""deletions"": 0, ""changes"": 4, ""blob_url"": ""https://github.com/chromium/chromium/blob/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/notify_parent.html"", ""raw_url"": ""https://github.com/chromium/chromium/raw/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/notify_parent.html"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/notify_parent.html?ref=fa17c9878dbeebf991b25ac0deb2b4635d85f1b6"", ""patch"": ""@@ -0,0 +1,4 @@\n+<!DOCTYPE html>\n+<script>\n+window.parent.subFrameLoaded();\n+</script>""}<_**next**_>{""sha"": ""beb12f5da551780fcb4378bef4661b9699a5d009"", ""filename"": ""third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/self_navigation.html"", ""status"": ""added"", ""additions"": 1, ""deletions"": 0, ""changes"": 1, ""blob_url"": ""https://github.com/chromium/chromium/blob/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/self_navigation.html"", ""raw_url"": ""https://github.com/chromium/chromium/raw/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/self_navigation.html"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/LayoutTests/external/wpt/resource-timing/resources/self_navigation.html?ref=fa17c9878dbeebf991b25ac0deb2b4635d85f1b6"", ""patch"": ""@@ -0,0 +1 @@\n+<meta http-equiv=\""refresh\"" content=\""0;url=notify_parent.html?redirected\"">""}<_**next**_>{""sha"": ""7102f3bceed8f489689bfd57c64344a3aab19c2d"", ""filename"": ""third_party/WebKit/LayoutTests/http/tests/w3c/webperf/submission/Google/resource-timing/html/test_resource_iframe_self_navigation.html"", ""status"": ""removed"", ""additions"": 0, ""deletions"": 48, ""changes"": 48, ""blob_url"": ""https://github.com/chromium/chromium/blob/c858650450f51cbff4a48689f9431b3b491d39e0/third_party/WebKit/LayoutTests/http/tests/w3c/webperf/submission/Google/resource-timing/html/test_resource_iframe_self_navigation.html"", ""raw_url"": ""https://github.com/chromium/chromium/raw/c858650450f51cbff4a48689f9431b3b491d39e0/third_party/WebKit/LayoutTests/http/tests/w3c/webperf/submission/Google/resource-timing/html/test_resource_iframe_self_navigation.html"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/LayoutTests/http/tests/w3c/webperf/submission/Google/resource-timing/html/test_resource_iframe_self_navigation.html?ref=c858650450f51cbff4a48689f9431b3b491d39e0"", ""patch"": ""@@ -1,48 +0,0 @@\n-<!DOCTYPE html>\n-<html>\n-<head>\n-<meta charset=\""utf-8\"" />\n-<title>Resource Timing self navigating iframes</title>\n-<link rel=\""author\"" title=\""Google\"" href=\""http://www.google.com/\"" />\n-<link rel=\""help\"" href=\""http://www.w3.org/TR/resource-timing/#dom-performanceresourcetiming-initiatortype\""/>\n-<script src=\""/w3c/resources/testharness.js\""></script>\n-<script src=\""/w3c/resources/testharnessreport.js\""></script>\n-<script src=\""/w3c/webperf/resources/webperftestharness.js\""></script>\n-<script src=\""/w3c/webperf/resources/webperftestharnessextension.js\""></script>\n-<script>\n-setup({explicit_done: true});\n-var d;\n-var iframe;\n-var iframeBody;\n-function setup_iframe() {\n-    var iframe_content = '<iframe id=\""innerFrame\"" src=\""/w3c/webperf/resources/inject_resource_test.html\""></iframe>';\n-    iframe = document.getElementById('frameContext');\n-    d = iframe.contentWindow.document;\n-    d.write(iframe_content);\n-    iframe.contentWindow.setup_iframe = setup_inner_iframe;\n-}\n-function setup_inner_iframe() {\n-    var iframe_content = '<script>window.location = \""/w3c/webperf/resources/generate_resource.php?type=iframe\"";</scr' + 'ipt>';\n-    var inner_iframe = d.getElementById('innerFrame');\n-    inner_iframe.contentWindow.document.write(iframe_content);\n-    inner_iframe.addEventListener(\""load\"", onload_test);\n-}\n-function onload_test() {\n-    var context = new PerformanceContext(iframe.contentWindow.performance);\n-    var entries = context.getEntriesByType('resource');\n-    var expected_entries = {\n-        '/w3c/webperf/resources/inject_resource_test.html': 'iframe',\n-    };\n-    test_resource_entries(entries, expected_entries);\n-    done();\n-}\n-window.setup_iframe = setup_iframe;\n-</script>\n-</head>\n-<body>\n-<h1>Description</h1>\n-<p>This test validates that iframes that navigate themselves don't appear in the buffer.</p>\n-<div id=\""log\""></div>\n-<iframe id=\""frameContext\"" src=\""/w3c/webperf/resources/inject_resource_test.html\""></iframe>\n-</body>\n-</html>""}<_**next**_>{""sha"": ""5494433ea6ad7cc21783cb462a95fcafd354047e"", ""filename"": ""third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.cpp"", ""status"": ""modified"", ""additions"": 2, ""deletions"": 1, ""changes"": 3, ""blob_url"": ""https://github.com/chromium/chromium/blob/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.cpp"", ""raw_url"": ""https://github.com/chromium/chromium/raw/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.cpp"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.cpp?ref=fa17c9878dbeebf991b25ac0deb2b4635d85f1b6"", ""patch"": ""@@ -78,7 +78,8 @@ HTMLFrameOwnerElement::HTMLFrameOwnerElement(const QualifiedName& tag_name,\n     : HTMLElement(tag_name, document),\n       content_frame_(nullptr),\n       embedded_content_view_(nullptr),\n-      sandbox_flags_(kSandboxNone) {}\n+      sandbox_flags_(kSandboxNone),\n+      did_load_non_empty_document_(false) {}\n \n LayoutEmbeddedContent* HTMLFrameOwnerElement::GetLayoutEmbeddedContent() const {\n   // HTMLObjectElement and HTMLEmbedElement may return arbitrary layoutObjects""}<_**next**_>{""sha"": ""d44d67c261cb07435fc847ca278f9bff596c6713"", ""filename"": ""third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h"", ""status"": ""modified"", ""additions"": 3, ""deletions"": 2, ""changes"": 5, ""blob_url"": ""https://github.com/chromium/chromium/blob/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h"", ""raw_url"": ""https://github.com/chromium/chromium/raw/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h?ref=fa17c9878dbeebf991b25ac0deb2b4635d85f1b6"", ""patch"": ""@@ -63,8 +63,8 @@ class CORE_EXPORT HTMLFrameOwnerElement : public HTMLElement,\n \n   Document* getSVGDocument(ExceptionState&) const;\n \n-  virtual bool LoadedNonEmptyDocument() const { return false; }\n-  virtual void DidLoadNonEmptyDocument() {}\n+  bool LoadedNonEmptyDocument() const { return did_load_non_empty_document_; }\n+  void DidLoadNonEmptyDocument() { did_load_non_empty_document_ = true; }\n \n   void SetEmbeddedContentView(EmbeddedContentView*);\n   EmbeddedContentView* ReleaseEmbeddedContentView();\n@@ -169,6 +169,7 @@ class CORE_EXPORT HTMLFrameOwnerElement : public HTMLElement,\n   Member<Frame> content_frame_;\n   Member<EmbeddedContentView> embedded_content_view_;\n   SandboxFlags sandbox_flags_;\n+  bool did_load_non_empty_document_;\n \n   WebParsedFeaturePolicy container_policy_;\n };""}<_**next**_>{""sha"": ""c25fe82ccd1e9bb5fc85b22f69c84628d7efcd9e"", ""filename"": ""third_party/WebKit/Source/core/html/HTMLIFrameElement.cpp"", ""status"": ""modified"", ""additions"": 0, ""deletions"": 1, ""changes"": 1, ""blob_url"": ""https://github.com/chromium/chromium/blob/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLIFrameElement.cpp"", ""raw_url"": ""https://github.com/chromium/chromium/raw/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLIFrameElement.cpp"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/Source/core/html/HTMLIFrameElement.cpp?ref=fa17c9878dbeebf991b25ac0deb2b4635d85f1b6"", ""patch"": ""@@ -39,7 +39,6 @@ using namespace HTMLNames;\n \n inline HTMLIFrameElement::HTMLIFrameElement(Document& document)\n     : HTMLFrameElementBase(iframeTag, document),\n-      did_load_non_empty_document_(false),\n       collapsed_by_client_(false),\n       sandbox_(HTMLIFrameElementSandbox::Create(this)),\n       referrer_policy_(kReferrerPolicyDefault) {}""}<_**next**_>{""sha"": ""0bdd164aabbe80c752fac712c2dcb97e29ee3568"", ""filename"": ""third_party/WebKit/Source/core/html/HTMLIFrameElement.h"", ""status"": ""modified"", ""additions"": 0, ""deletions"": 7, ""changes"": 7, ""blob_url"": ""https://github.com/chromium/chromium/blob/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLIFrameElement.h"", ""raw_url"": ""https://github.com/chromium/chromium/raw/fa17c9878dbeebf991b25ac0deb2b4635d85f1b6/third_party/WebKit/Source/core/html/HTMLIFrameElement.h"", ""contents_url"": ""https://api.github.com/repos/chromium/chromium/contents/third_party/WebKit/Source/core/html/HTMLIFrameElement.h?ref=fa17c9878dbeebf991b25ac0deb2b4635d85f1b6"", ""patch"": ""@@ -66,12 +66,6 @@ class CORE_EXPORT HTMLIFrameElement final\n   bool LayoutObjectIsNeeded(const ComputedStyle&) override;\n   LayoutObject* CreateLayoutObject(const ComputedStyle&) override;\n \n-  bool LoadedNonEmptyDocument() const override {\n-    return did_load_non_empty_document_;\n-  }\n-  void DidLoadNonEmptyDocument() override {\n-    did_load_non_empty_document_ = true;\n-  }\n   bool IsInteractiveContent() const override;\n \n   ReferrerPolicy ReferrerPolicyAttribute() override;\n@@ -84,7 +78,6 @@ class CORE_EXPORT HTMLIFrameElement final\n   AtomicString name_;\n   AtomicString csp_;\n   AtomicString allow_;\n-  bool did_load_non_empty_document_;\n   bool allow_fullscreen_;\n   bool allow_payment_request_;\n   bool collapsed_by_client_;""}"," inline HTMLIFrameElement::HTMLIFrameElement(Document& document)
     : HTMLFrameElementBase(iframeTag, document),
       collapsed_by_client_(false),
       sandbox_(HTMLIFrameElementSandbox::Create(this)),
       referrer_policy_(kReferrerPolicyDefault) {}
"," inline HTMLIFrameElement::HTMLIFrameElement(Document& document)
     : HTMLFrameElementBase(iframeTag, document),
      did_load_non_empty_document_(false),
       collapsed_by_client_(false),
       sandbox_(HTMLIFrameElementSandbox::Create(this)),
       referrer_policy_(kReferrerPolicyDefault) {}
",C,,"      did_load_non_empty_document_(false),
",,"@@ -39,7 +39,6 @@ using namespace HTMLNames;
 
 inline HTMLIFrameElement::HTMLIFrameElement(Document& document)
     : HTMLFrameElementBase(iframeTag, document),
-      did_load_non_empty_document_(false),
       collapsed_by_client_(false),
       sandbox_(HTMLIFrameElementSandbox::Create(this)),
       referrer_policy_(kReferrerPolicyDefault) {}",Chrome,fa17c9878dbeebf991b25ac0deb2b4635d85f1b6,c858650450f51cbff4a48689f9431b3b491d39e0,1," inline HTMLIFrameElement::HTMLIFrameElement(Document& document)
     : HTMLFrameElementBase(iframeTag, document),
//flaw_line_below:
      did_load_non_empty_document_(false),
       collapsed_by_client_(false),
       sandbox_(HTMLIFrameElementSandbox::Create(this)),
       referrer_policy_(kReferrerPolicyDefault) {}
"
